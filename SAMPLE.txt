[20251124üáßüá∑08:30:18] INFO njyaa [MainThread] njyaa: Read (NJYAA_CONSOLE_ENABLED: ''TRUE'') --> cfg.CONSOLE_ENABLED
[20251124üáßüá∑08:30:19] INFO njyaa [MainThread] Clock TZ set {"tz": "America/Fortaleza"}
[20251124üáßüá∑08:30:20] INFO njyaa [MainThread] MarketCatalog loaded (USDT PERPETUAL only) {"symbols": 535, "bases": 535}
[20251124üáßüá∑08:30:20] INFO njyaa [njyaa-worker] Worker started
[20251124üáßüá∑08:30:20] INFO njyaa [njyaa-worker] Worker started
[20251124üáßüá∑08:30:20] INFO njyaa [MainThread] Worker thread started
[20251124üáßüá∑08:30:20] INFO njyaa [MainThread] Engine running without Telegram
[20251124üáßüá∑08:30:20] INFO njyaa [njyaa-console] Console ready; type @help or :q to exit
>






   ?help det[20251124üáßüá∑08:30:27] INFO njyaa.thinking [njyaa-scheduler] thinker.ready {"id": 1, "kind": "HORSE_WITH_NO_NAME"}
[20251124üáßüá∑08:30:27] WARN njyaa [njyaa-scheduler] HORSE SAYS: ((('Cause there ain't no one for to give you no pain)))
HORSE SAYS: ((('Cause there ain't no one for to give you no pain)))
[20251124üáßüá∑08:30:27] INFO njyaa.thinking [njyaa-scheduler] thinker.ready {"id": 3, "kind": "RISK_MONITOR"}
[20251124üáßüá∑08:30:27] WARN njyaa [njyaa-scheduler] [risk] #5 drawdown -448.77 <= -1.0R (risk=0.020, budget=240.00) {"exposure": 28014.96647, "max_exposure": 36000.0, "ref_balance": 12000.0, "leverage": 3.0}
[risk] #5 drawdown -448.77 <= -1.0R (risk=0.020, budget=240.00)
[20251124üáßüá∑08:30:27] INFO njyaa.thinking [njyaa-scheduler] thinker.ready {"id": 4, "kind": "TRAILING_STOP"}
[20251124üáßüá∑08:30:27] INFO njyaa [njyaa-scheduler] thinker.result {"result": "0", "thinker_id": 4, "kind": "TRAILING_STOP"}
ai;l:4> ?help detail:4
  Commands                                                                                                                                                                                    
‚ñì‚ñë‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñë‚ñì                                                                                                                                                                                  

!alert ‚ü®symbol‚ü© ‚ü®op‚ü© ‚ü®price‚ü© [msg:‚Ä¶]                                                                                                                                                          

Create a simple threshold alert thinker.                                                                                                                                                      

                                                                                                                                                                                              
   Usage:                                                                                                                                                                                     
     !alert <SYMBOL> (>=|<=) <PRICE> [msg:...]                                                                                                                                                
                                                                                                                                                                                              

!exit-attach ‚ü®thinker_id‚ü© ‚ü®position_id‚ü© [at:‚Ä¶] [lookback:‚Ä¶] [policies:‚Ä¶]

Attach trailing/exit policies to a position.                                                                                                                                                  

                                                                                                                                                                                              
   Usage:                                                                                                                                                                                     
     !exit-attach <thinker_id> <position_id> [policies:<json>] [lookback:200] [at:<iso|rel>]
                                                                                                                                                                                              
   at: iso (local) like 2024-08-20T15:30 or relative like -5m/+2h; defaults to now.                                                                                                           
                                                                                                                                                                                              

!config-set [default_risk:‚Ä¶] [leverage:‚Ä¶] [reference_balance:‚Ä¶] [updated_by:‚Ä¶]                                                                                                                

Update global risk config.                                                                                                                                                                    

                                                                                                                                                                                              
   Usage:                                                                                                                                                                                     
     !config-set reference_balance:12000 leverage:2.0 default_risk:0.015                                                                                                                      
                                                                                                                                                                                              

!exit-detach ‚ü®thinker_id‚ü© ‚ü®position_id‚ü©                                                                                                                                                       

Remove trailing/exit attachment for a position.                                                                                                                                               

!leg-set ‚ü®leg_id‚ü© [entry_price:‚Ä¶] [entry_price_ts:‚Ä¶] [need_backfill:‚Ä¶] [note:‚Ä¶] [position_id:‚Ä¶] [price_method:‚Ä¶] [qty:‚Ä¶] [symbol:‚Ä¶]                                                           

Update fields in a leg row (by leg_id).                                                                                                                                                       

                                                                                                                                                                                              
   Usage:                                                                                                                                                                                     
     !leg-set <leg_id> [position_id:123] [symbol:ETHUSDT] [qty:-0.75]                                                                                                                         
                      [entry_price:3521.4] [entry_price_ts:<when>]                                                                                                                            
                      [price_method:aggTrade|kline|mark_kline] [need_backfill:0|1]                                                                                                            
                      [note:...]                                                                                                                                                              
                                                                                                                                                                                              
   Notes:                                                                                                                                                                                     
     - entry_price_ts accepts ISO or epoch via parse_when().                                                                                                                                  
     - Changing position_id/symbol must respect UNIQUE(position_id,symbol).                                                                                                                   
                                                                                                                                                                                              

!leg-set-ebyp ‚ü®leg_id‚ü© ‚ü®price‚ü© [lookback_days:‚Ä¶]                                                                                                                                              

Entry-by-price set                                                                                                                                                                            

                                                                                                                                                                                              
   Set a leg's entry_price and entry_price_ts by locating the most recent candle                                                                                                              
   whose [low, high] contains the given price, using a configurable coarse‚Üífine path.                                                                                                         
                                                                                                                                                                                              
   Usage:                                                                                                                                                                                     
     !leg-backfill-price <leg_id> <price> [lookback_days:365]                                                                                                                                 
                                                                                                                                                                                              
   Behavior:                                                                                                                                                                                  
     - If the coarsest TF finds no engulfing candle over the lookback, it fails.                                                                                                              
     - Otherwise it refines inside that candle's window; if a finer TF has no hit,                                                                                                            
       it uses the last level that did.                                                                                                                                                       
                                                                                                                                                                                              

!open ‚ü®pair‚ü© ‚ü®ts‚ü© ‚ü®usd‚ü© [note:‚Ä¶] [risk:‚Ä¶]                                                                                                                                                     

Open/add an RV position.                                                                                                                                                                      

                                                                                                                                                                                              
   Usage:                                                                                                                                                                                     
     !open <ISO|epoch_ms> <NUM/DEN|SYMBOL> <¬±usd> [risk:0.02] [note:...]                                                                                                                      
                                                                                                                                                                                              
   Examples:                                                                                                                                                                                  
     !open STRK/ETH 2025-11-10T13:44:05  -5000 note:rv test                                                                                                                                   
     !open ETHUSDT  2025-11-10T13:44:05 +3000                                                                                                                                                 
                                                                                                                                                                                              

!position-rm ‚ü®position_id‚ü©                                                                                                                                                                    

!position-set ‚ü®position_id‚ü© [closed_ts:‚Ä¶] [created_ts:‚Ä¶] [den:‚Ä¶] [dir_sign:‚Ä¶] [note:‚Ä¶] [num:‚Ä¶] [risk:‚Ä¶] [status:‚Ä¶] [target_usd:‚Ä¶] [user_ts:‚Ä¶]                                                 

Update fields in a position row (by position_id).                                                                                                                                             

                                                                                                                                                                                              
   Usage:                                                                                                                                                                                     
     !position-set <position_id> [num:ETHUSDT] [den:STRKUSDT|-] [dir_sign:-1|+1]                                                                                                              
                     [target_usd:5000] [risk:0.02] [user_ts:<when>] [closed_ts:<when>]                                                                                                        
                     [status:OPEN|CLOSED]                                                                                                                                                     
                     [note:...] [created_ts:<when>]                                                                                                                                           
                                                                                                                                                                                              
   Notes:                                                                                                                                                                                     
     - user_ts/created_ts accept ISO or epoch via parse_when().                                                                                                                               
     - den:"-" (or empty/none/null) clears denominator (single-leg).                                                                                                                          
                                                                                                                                                                                              

!psar ‚ü®position_id‚ü© ‚ü®symbol‚ü© ‚ü®direction‚ü© [af:‚Ä¶] [max:‚Ä¶] [max_af:‚Ä¶] [win:‚Ä¶] [window:‚Ä¶] [window_min:‚Ä¶]                                                                                          

Set a PSAR stop thinker.                                                                                                                                                                      

                                                                                                                                                                                              
   Usage:                                                                                                                                                                                     
     !psar <position_id> <symbol> <LONG|SHORT> [af:0.02] [max:0.2] [win:200]                                                                                                                  
                                                                                                                                                                                              

!retry_jobs [id:‚Ä¶] [limit:‚Ä¶]                                                                                                                                                                  

Retry failed jobs.                                                                                                                                                                            

                                                                                                                                                                                              
   Usage:                                                                                                                                                                                     
     !retry_jobs [id:<job_id>] [limit:N]                                                                                                                                                      
       - With id: retries one job.                                                                                                                                                            
       - Without id: retries all ERR jobs (optionally limited).                                                                                                                               
                                                                                                                                                                                              

!thinker-disable ‚ü®id‚ü©                                                                                                                                                                         

Disable a thinker by ID                                                                                                                                                                       

                                                                                                                                                                                              
   Usage: !thinker-disable <id>                                                                                                                                                               
                                                                                                                                                                                              

!thinker-enable ‚ü®id‚ü©                                                                                                                                                                          

Enable a thinker by ID.                                                                                                                                                                       

                                                                                                                                                                                              
   Usage:: !thinker-enable <id>                                                                                                                                                               
                                                                                                                                                                                              

!thinker-new ‚ü®kind‚ü© [enabled:‚Ä¶]                                                                                                                                                               

Create a new thinker row.                                                                                                                                                                     

                                                                                                                                                                                              
   Usage:                                                                                                                                                                                     
     !thinker-new <kind|index> [enabled:0|1]                                                                                                                                                  
                                                                                                                                                                                              

!thinker-rm ‚ü®id‚ü©                                                                                                                                                                              

Delete a thinker by ID.                                                                                                                                                                       

                                                                                                                                                                                              
   Usage: !thinker-rm <id>                                                                                                                                                                    
                                                                                                                                                                                              

!thinker-set ‚ü®id‚ü© [key=val ...]                                                                                                                                                               

Update a thinker's config with free-form key=val pairs.                                                                                                                                       

                                                                                                                                                                                              
   Usage:                                                                                                                                                                                     
     !thinker-set <id> <key>=<val> [more...]                                                                                                                                                  
                                                                                                                                                                                              

?chart-candle ‚ü®symbol‚ü© ‚ü®timeframe‚ü© [‚ü®n‚ü©]                                                                                                                                                      

Render candlestick chart (with volume & a simple indicator).                                                                                                                                  

                                                                                                                                                                                              
   Usage:                                                                                                                                                                                     
     @chart-candle <symbol> <timeframe> [<n=200>]                                                                                                                                             
                                                                                                                                                                                              
   Example:                                                                                                                                                                                   
     @chart-candle ETHUSDT 1m 300                                                                                                                                                             
                                                                                                                                                                                              

?chart-exit ‚ü®thinker_id‚ü© ‚ü®position_id‚ü© [n:‚Ä¶]                                                                                                                                                  

Plot recorded exit/indicator history against price for a position.                                                                                                                            

?chart-pnl ‚ü®which‚ü© [‚ü®timeframe‚ü©] [‚ü®from‚ü©] [‚ü®to‚ü©]                                                                                                                                              

Plot PnL over time for one position or all open positions.                                                                                                                                    

                                                                                                                                                                                              
   Usage:                                                                                                                                                                                     
     @chart-pnl <position_id|all> [<timeframe=1d>] [from:] [to:]                                                                                                                              
                                                                                                                                                                                              

?chart-rv ‚ü®pair_or_symbol‚ü© [‚ü®timeframe‚ü©] [‚ü®n‚ü©]                                                                                                                                                

Render Close-price line chart (single symbol or ratio) with MA.                                                                                                                               

                                                                                                                                                                                              
   Usage:                                                                                                                                                                                     
     @chart-rv <pair_or_symbol> [<timeframe=1d>] [<n=200>]                                                                                                                                    
                                                                                                                                                                                              
   Example:                                                                                                                                                                                   
     @chart-rv ETH/BTC 4h 500                                                                                                                                                                 
                                                                                                                                                                                              

?exit-list ‚ü®thinker_id‚ü©                                                                                                                                                                       

List exit/trailing attachments.                                                                                                                                                               

?exit-state ‚ü®thinker_id‚ü© ‚ü®position_id‚ü©                                                                                                                                                        

Show trailing stop state for a position.                                                                                                                                                      

?help [‚ü®command‚ü©] [detail:‚Ä¶]                                                                                                                                                                  

?jobs [limit:‚Ä¶] [state:‚Ä¶]                                                                                                                                                                     

List DB jobs.                                                                                                                                                                                 

                                                                                                                                                                                              
   Usage:                                                                                                                                                                                     
     @jobs [state:PENDING|RUNNING|DONE|ERR] [limit:50]                                                                                                                                        
                                                                                                                                                                                              

?klines-cache                                                                                                                                                                                 

Summary of cached klines by (symbol, timeframe).                                                                                                                                              

                                                                                                                                                                                              
   Columns: symbol, timeframe, n                                                                                                                                                              
   Ordered by symbol, timeframe (ms).                                                                                                                                                         
                                                                                                                                                                                              
   Usage:                                                                                                                                                                                     
     @klines-cache                                                                                                                                                                            
                                                                                                                                                                                              

?open                                                                                                                                                                                         

List open RV positions (summary). Alias for: @positions status:open detail:2                                                                                                                  

?pnl-symbols [status:‚Ä¶]                                                                                                                                                                       

Aggregate PnL per symbol by traversing legs directly.                                                                                                                                         

                                                                                                                                                                                              
   Usage:                                                                                                                                                                                     
     @pnl-symbols [status:open|closed|all]                                                                                                                                                    
                                                                                                                                                                                              
   Notes:                                                                                                                                                                                     
     - Uses last cached close from KlinesCache as mark price.                                                                                                                                 
     - PnL per leg = (mark - entry_price) * qty.                                                                                                                                              
     - If any of (entry_price, qty, mark) is missing, PnL is "?" and                                                                                                                          
       treated as 0 in aggregates, but missing counts are reported.                                                                                                                           
                                                                                                                                                                                              

?positions [detail:‚Ä¶] [limit:‚Ä¶] [pair:‚Ä¶] [position_id:‚Ä¶] [sort:‚Ä¶] [status:‚Ä¶]                                                                                                                  

Positions report with detail levels.                                                                                                                                                          

                                                                                                                                                                                              
   status: open/closed/all                                                                                                                                                                    
                                                                                                                                                                                              
   detail: 1 = summary                                                                                                                                                                        
           2 = summary + per-position overview (with opened datetime & signed target)                                                                                                         
           3 = per-symbol leg summary (agg qty, WAP, last price, PnL)                                                                                                                         
           4 = list every leg (timestamp, entry, last, qty, PnL)                                                                                                                              
                                                                                                                                                                                              
   Examples:                                                                                                                                                                                  
     ?positions detail:1                                                                                                                                                                      
     ?positions status:closed detail:2                                                                                                                                                        
     ?positions pair:STRK/ETH detail:3 limit:20                                                                                                                                               
                                                                                                                                                                                              

?risk                                                                                                                                                                                         

Show risk/exposure snapshot.                                                                                                                                                                  

?thinker-kinds [detail:‚Ä¶]                                                                                                                                                                     

List available thinker kinds (from factory auto-discovery).                                                                                                                                   

?thinkers [‚ü®thinker_id‚ü©] [detail:‚Ä¶]                                                                                                                                                           

List thinkers stored in DB.                                                                                                                                                                   

>






   [20251124üáßüá∑08:30:38] WARN njyaa [njyaa-scheduler] HORSE SAYS: (((On the first part of the journey)))
HORSE SAYS: (((On the first part of the journey)))
[20251124üáßüá∑08:30:38] INFO njyaa [njyaa-scheduler] thinker.result {"result": "0", "thinker_id": 4, "kind": "TRAILING_STOP"}
[20251124üáßüá∑08:30:48] INFO njyaa [njyaa-scheduler] thinker.result {"result": "0", "thinker_id": 4, "kind": "TRAILING_STOP"}
[20251124üáßüá∑08:30:58] INFO njyaa [njyaa-scheduler] thinker.result {"result": "0", "thinker_id": 4, "kind": "TRAILING_STOP"}
>                                                                              
                                                                                

[20251124üáßüá∑08:31:03] INFO njyaa [MainThread] Main loop: stop signal received
[20251124üáßüá∑08:31:03] INFO njyaa [MainThread] Engine stopping ‚Ä¶
[20251124üáßüá∑08:31:03] INFO njyaa [MainThread] Console: stopping UI thread
[20251124üáßüá∑08:31:03] INFO njyaa [MainThread] Console: thread joined
[20251124üáßüá∑08:31:03] INFO njyaa [MainThread] Scheduler: stopping
